---
title: 漫谈营销ID体系(1) - IOS篇
date: 2018-05-15
categories: 计算广告
---

依稀记得我作为新人进入数字化营销领域，听到最多的一个话题就是`用什么来追踪和识别用户`。先聊聊iOS端，iOS设备ID有很多，通常用到的大概有以下六个，例如UDID、IMEI、ICCID、MEID、IDFA、MAC地址等，一台苹果手机的标识方式很多，不同标识方式又有不同的参数信息。随着iOS系统的升级，很多设备ID苹果禁止开发者获取，或者给用户诸多人性选择空间。下面详细说说参数的定位及用途，其中最为大家关注的就是IDFA。

<!--more-->


## 标识符点将台


### 1 谁用谁知道 - UDID   

`UDID(UniqueDevice Identifier)`是苹果iOS设备的唯一识别码，由40个字符的字母和数字组成。移动广告商往往需要通过UDID用来识别玩家、用户，并对用户活动进行跟踪;也经常会用于一台设备一个账号功能实现。

iOS 6及以前系统是可以获取到设备的UDID，iOS 7中已经完全的禁用。


### 2 禁止我偏用 - UDID OpenUDID
在Apple拒绝UDID后，OpenUDID作为独立于Apple的开源方案，被广大的开发者所接受，各大统计广告平台都从UDID等方案切换到OpenUDID的方案（看来大家都不想完全被Apple束缚啊），但不幸的事，同样由于iOS7对剪贴板的限制，导致同一个设备上应用间，无法再共享一个OpenUDID，即OpenUDID作为设备唯一标识的能力被大大削弱。也可以看到随着iOS7的来临，各广告平台都迅速更新自己的SDK，来切换到苹果的idfa的方案上来。

 
### 3 当前最广泛 - IDFA  

`IDFA(Identifier for Advertising)`称为`广告标示符`，是苹果在iOS系统中给予App开发者用以标识iOS设备的一种身份参数。对广告主而言，IDFA最大的作用就是准确认识这个设备代表的用户，确认广告是否有效触达，避免将同一个广告重复投放造成预算浪费，同时进行真实性监测。而对整个广告行业来说，IDFA是形成数据链条的必须手段，广告网络、DSP和DMP都需要一个统一的设备数据身份核对标准。

### 4 一般不能用 - IMEI

IMEI(International Mobile Equipment Identity)是国际移动装备辨识码，是由15位数字组成的"电子串号"，它与每台移动电设备一一对应，而且该码是全世界唯一的。每一只移动电话机在组装完成后都将被赋予一个全球唯一的一组号码，这个号码从生产到交付使用都将被制造生产的厂商所记录。

iOS 6及以后系统就不能正规获取IMEI，但可以通过私有API获取手机的IMEI号，一般苹果发现有通过私有API获取设备ID，上架时会予以拒绝。如果在线产品被发现会立马下架，2015年有米SDK下架风波就是因为通过私有API获取设备ID，触动了苹果的底线，导致一夜之间近300款应用被下架，其中不乏大产品。

  
### 5 分析最好用 - IDFV

说明：顾名思义，是给Vendor标识用户用的，每个设备在所属同一个Vender的应用里，都有相同的值。其中的Vender是指应用提供商，但准确点说，是通过BundleID的DNS反转的前两部分进行匹配，如果相同就是同一个Vender，例如对于com.somecompany.appone,com.somecompany.apptwo 这两个BundleID来说，就属于同一个Vender，共享同一个idfv的值。和idfa不同的是，idfv的值是一定能取到的，所以非常适合于作为内部用户行为分析的主id，来标识用户，替代OpenUDID。注意：如果用户将属于此Vender的所有App卸载，则idfv的值会被重置，即再重装此Vender的App，idfv的值和之前不同。

### 6 看你怎么用 - Mac地址
每一个网卡都有一个唯一的标识，即Mac地址，显然用来标识一个手机是绰绰有余的了，也有一些开源的方案也用到了它，国内UMTrack等也用它作为过主id，随着iOS7返回同样的值后，不得不退隐江湖。

## 渠道追踪与监测

在移动领域，分为两大阵营，`iOS（Apple）`和`安卓（Google）`。这两家发行渠道差异比较大。出现这种情况的原因在于 Google 官方应用商店 `Google Play` 在国内受制于`GFW(Great Fire Wall)` 一直处于无法使用的状态，所以国内的安卓 App 分发，都是依托数十个不同的应用市场或发行渠道，如百度、360、腾讯等互联网企业以及一加（`壮哉我大一加，一加六大家快点买起来 ！！！`）、小米、华为、魅族等手机生产商。对于安卓 App 的渠道追踪，主要是围绕上面这些大的渠道来进行。

iOS 的发行渠道则与安卓有很大的不同，大部分用户的 App 都是从 App Store 下载的。iOS 的“渠道”其实通常是指那些在其它 App 或者网页内部，提供到 AppStore 的链接的页面。因此，在 iOS 中追踪发行渠道，主要是追踪进入 App Store 相关页面的渠道信息。

### iOS几种跟踪方案对比

|应用市场|跟踪方案|优点|缺点|
|---|---|---|---|---|
|APP Store|IDFA|准确度高|IDFA有可能被停用、系统重置可能会导致IDFA变更|
|APP Store|Cookie|准确度高|iOS9以上才适用；朋友圈公众号广告、朋友圈广告无法实现追踪|
|APP Store|模糊匹配|准确度不确定|准确性依赖于算法|

#### Cookie 追踪

基于Cookie的方式，iOS 9中新增的`SFSafariViewController`，这个类的API允许在App内打开一个Safari浏览器，而不是一个App内部的Webview。这个App内的Safari和外面系统的Safari是同一个，共享同一个沙盒，可以操作同一个Cookie，也就是说它可以跨App与Safari实现共享Cookie。

基于`SFSafariViewController`控件，当用户在App中通过它打开渠道页面时，我们可以将渠道信息写入Cookie中，并设置生效时间。当用户安装并激活 App后，再次使用`SFSafariViewController`上报激活信息，同时将Cookie中的渠道信息上传，通过匹配，便可确定下载来源。由于渠道信息保存在设备本地，因此匹配是100%准确的。

但是基于`SFSafariViewController`这种方式也有一定的弊端：首先，这个方案只能支持iOS9及以上版本的设备，但覆盖了绝大部分用户，此外，对于目前业界主流的一些推广渠道，如微信、朋友圈，它们尚未在App中使用`SFSafariViewController`控件访问网页，因此这部分渠道也无法使用精准匹配的方案。

#### IDFA 追踪

媒体的App（例如微信，这里就是媒体1，2,3），会详细记录哪个IDFA点击了待推广App（例如）的链接（或是在微信中嵌入SDK去记录），而聚美本身，也会记录具体的哪个IDFA激活了聚美App，两者都将记录下来的IDFA上传至指定的服务器，进行对比，即可确定下载来源。在用户不重置系统，不还原广告的情况下，这种方式精准度比较高。网页不支持这种形式。

#### 模糊匹配


模糊匹配，点击下载链接，会跳转到Appstore页面，这个过程会触发一个服务端的请求，服务器来记录这次点击的设备信息，包括ip地址、机型等。同时，被推广App这边，也可以记录用户激活App时机器的一些基本信息，并上传至服务器。结合下载和激活的时间差，再结合设备的IP地址和机型等信息，大概可以模糊地识别出同一个用户先点击了下载链接，再激活了App，从而确定下载渠道。这种方式的精确度取决于前后两次数据收集的完成程度和算法。


### 市场上几种主流工具对比

|工具|匹配方案|
|---|---|
|Google Analytics|IDFA|
|Adobe Analytics|模糊匹配|
|Umeng| 模糊匹配 |
|GrowingIO|IDFA-模糊匹配|
|诸葛ID|IDFA/IDFV|
|神策|Cookie + 模糊匹配|




